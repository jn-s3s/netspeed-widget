name: 📦 Build test release executable file
on:
  push:
    branches:
      - test-build
jobs:
  build-from-tag-test-release:
    runs-on: windows-latest
    steps:
      - name: 🔄 Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          fetch-tags: true
      - name: 🐍 Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: ♻️ Restore build cache
        uses: actions/cache@v4
        id: build-cache
        with:
          path: dist
          key: build-dist-${{ runner.os }}-${{ hashFiles('build.py', 'src/**/*.py', 'requirements.txt', '!src/**/tests/**') }}
          restore-keys: |
            build-dist-${{ runner.os }}-
      - name: 📦 Install/Update pip
        if: steps.build-cache.outputs.cache-hit != 'true'
        run: |
          python -m pip install --upgrade pip
      - name: 🛠️ Run Build Script
        if: steps.build-cache.outputs.cache-hit != 'true'
        run: python build.py
      - name: 📁 Check build output
        run: dir dist